
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Code Manager &#8212; CL Lab Project 2022 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxdoc.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Semantic Errors" href="semerrors.html" />
    <link rel="prev" title="Tree Decoration" href="decoration.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="semerrors.html" title="Semantic Errors"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="decoration.html" title="Tree Decoration"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CL Lab Project 2022 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../project.html" accesskey="U">Lab Project of Compilers - FIB UPC, 2022</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Code Manager</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="code-manager">
<h1>Code Manager<a class="headerlink" href="#code-manager" title="Permalink to this headline">Â¶</a></h1>
<p>When generating code, our compiler will need to handle pieces of code created by different subtrees and combine them together to create more code (e.g. to create code for a <em>while</em>, the compiler will need to combine the code to compute the expression and the code of the instruction inside the loop with the right labels and jump instructions).</p>
<p>The Code Manager module provides a class <code class="docutils literal notranslate"><span class="pre">code</span></code> that can be used to handle this code combinations, and finally write it to the output file when it is complete. Objects of type <code class="docutils literal notranslate"><span class="pre">code</span></code> contain <code class="docutils literal notranslate"><span class="pre">subroutine</span></code> objects, which contain <code class="docutils literal notranslate"><span class="pre">instructionList</span></code> objects, which in turn contain <code class="docutils literal notranslate"><span class="pre">instruction</span></code> objects.</p>
<p>All these classes have methods to extend and combine them (e.g. add a <code class="docutils literal notranslate"><span class="pre">subroutine</span></code> to a <code class="docutils literal notranslate"><span class="pre">code</span></code>, or add an <code class="docutils literal notranslate"><span class="pre">instruction</span></code> to an <code class="docutils literal notranslate"><span class="pre">instructionList</span></code>, concatenate two <code class="docutils literal notranslate"><span class="pre">instructionList</span></code> objects, etc.)</p>
<p>Additionally, this module contains also a static class <code class="docutils literal notranslate"><span class="pre">counters</span></code> that manages counters to generate labels for jumps in <em>if</em> and <em>while</em> instructions, and well as for temporal registers.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="k">class</span><span class="w"> </span><span class="nc">instructionList</span><span class="p">;</span><span class="w"></span>
<span class="linenos">  2</span><span class="k">class</span><span class="w"> </span><span class="nc">LLVMCodeGen</span><span class="p">;</span><span class="w"></span>
<span class="linenos">  3</span>
<span class="linenos">  4</span><span class="c1">////////////////////////////////////////////////////////////////////</span>
<span class="linenos">  5</span><span class="c1">/// Class instruction stores a VM instruction code with its operands</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="k">class</span><span class="w"> </span><span class="nc">instruction</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">  8</span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="linenos">  9</span><span class="w">  </span><span class="c1">/// instruction codes</span>
<span class="linenos"> 10</span><span class="w">  </span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="n">_LABEL</span><span class="p">,</span><span class="w"> </span><span class="n">_UJUMP</span><span class="p">,</span><span class="w"> </span><span class="n">_FJUMP</span><span class="p">,</span><span class="w"> </span><span class="n">_PUSH</span><span class="p">,</span><span class="w"> </span><span class="n">_POP</span><span class="p">,</span><span class="w"> </span><span class="n">_CALL</span><span class="p">,</span><span class="w"> </span><span class="n">_RETURN</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 11</span><span class="w">                </span><span class="n">_ADD</span><span class="p">,</span><span class="w"> </span><span class="n">_SUB</span><span class="p">,</span><span class="w"> </span><span class="n">_MUL</span><span class="p">,</span><span class="w"> </span><span class="n">_DIV</span><span class="p">,</span><span class="w"> </span><span class="n">_EQ</span><span class="p">,</span><span class="w"> </span><span class="n">_LT</span><span class="p">,</span><span class="w"> </span><span class="n">_LE</span><span class="p">,</span><span class="w"> </span><span class="n">_NEG</span><span class="p">,</span><span class="w"> </span><span class="n">_NOT</span><span class="p">,</span><span class="w"> </span><span class="n">_AND</span><span class="p">,</span><span class="w"> </span><span class="n">_OR</span><span class="p">,</span><span class="w"> </span><span class="n">_FLOAT</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 12</span><span class="w">                </span><span class="n">_FADD</span><span class="p">,</span><span class="w"> </span><span class="n">_FSUB</span><span class="p">,</span><span class="w"> </span><span class="n">_FMUL</span><span class="p">,</span><span class="w"> </span><span class="n">_FDIV</span><span class="p">,</span><span class="w"> </span><span class="n">_FEQ</span><span class="p">,</span><span class="w"> </span><span class="n">_FLT</span><span class="p">,</span><span class="w"> </span><span class="n">_FLE</span><span class="p">,</span><span class="w"> </span><span class="n">_FNEG</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 13</span><span class="w">                </span><span class="n">_LOAD</span><span class="p">,</span><span class="w"> </span><span class="n">_ILOAD</span><span class="p">,</span><span class="w"> </span><span class="n">_CHLOAD</span><span class="p">,</span><span class="w"> </span><span class="n">_FLOAD</span><span class="p">,</span><span class="w"> </span><span class="n">_XLOAD</span><span class="p">,</span><span class="w"> </span><span class="n">_LOADX</span><span class="p">,</span><span class="w"> </span><span class="n">_ALOAD</span><span class="p">,</span><span class="w"> </span><span class="n">_LOADC</span><span class="p">,</span><span class="w"> </span><span class="n">_CLOAD</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 14</span><span class="w">                </span><span class="n">_READI</span><span class="p">,</span><span class="w"> </span><span class="n">_READF</span><span class="p">,</span><span class="w"> </span><span class="n">_READC</span><span class="p">,</span><span class="w"> </span><span class="n">_WRITEI</span><span class="p">,</span><span class="w"> </span><span class="n">_WRITEF</span><span class="p">,</span><span class="w"> </span><span class="n">_WRITEC</span><span class="p">,</span><span class="w"> </span><span class="n">_WRITES</span><span class="p">,</span><span class="w"> </span><span class="n">_WRITELN</span><span class="p">,</span><span class="w"> </span><span class="n">_NOOP</span><span class="p">,</span><span class="w"> </span><span class="n">_INVALID</span><span class="p">}</span><span class="w"> </span><span class="n">Operation</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 15</span><span class="w">  </span>
<span class="linenos"> 16</span><span class="w">  </span><span class="c1">/// instruction code</span>
<span class="linenos"> 17</span><span class="w">  </span><span class="n">Operation</span><span class="w"> </span><span class="n">oper</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 18</span><span class="w">  </span><span class="c1">/// arguments</span>
<span class="linenos"> 19</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">,</span><span class="w"> </span><span class="n">arg3</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 20</span><span class="w">  </span>
<span class="linenos"> 21</span><span class="w">  </span><span class="c1">/// constructor</span>
<span class="linenos"> 22</span><span class="w">  </span><span class="n">instruction</span><span class="p">(</span><span class="n">Operation</span><span class="w"> </span><span class="n">op</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 23</span><span class="w">              </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="w">  </span><span class="c1">/// destructor</span>
<span class="linenos"> 26</span><span class="w">  </span><span class="o">~</span><span class="n">instruction</span><span class="p">();</span><span class="w"></span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span><span class="w">  </span><span class="c1">// concatenation of instruction+list (or instruction+instruction, via automatic coertion)</span>
<span class="linenos"> 29</span><span class="w">  </span><span class="n">instructionList</span><span class="w"> </span><span class="k">operator</span><span class="o">||</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">instructionList</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lst</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span><span class="w">  </span><span class="c1">/// ------ specific constructors for each instruction -------</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 :&quot;</span>
<span class="linenos"> 34</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">LABEL</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 35</span><span class="w">  </span><span class="c1">// create new instruction &quot;goto a1&quot;</span>
<span class="linenos"> 36</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">UJUMP</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 37</span><span class="w">  </span><span class="c1">// create new instruction &quot;ifFalse a1 goto a2&quot;</span>
<span class="linenos"> 38</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">FJUMP</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 39</span><span class="w">  </span><span class="c1">// create new instruction &quot;pushparam a1&quot;</span>
<span class="linenos"> 40</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">PUSH</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 41</span><span class="w">  </span><span class="c1">// create new instruction &quot;popparam a1&quot;</span>
<span class="linenos"> 42</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">POP</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 43</span><span class="w">  </span><span class="c1">// create new instruction &quot;call a1&quot;</span>
<span class="linenos"> 44</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">CALL</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 45</span><span class="w">  </span><span class="c1">// create new instruction &quot;return&quot;</span>
<span class="linenos"> 46</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">RETURN</span><span class="p">();</span><span class="w"></span>
<span class="linenos"> 47</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 + a3&quot;</span>
<span class="linenos"> 48</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">ADD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 49</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 - a3&quot;</span>
<span class="linenos"> 50</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">SUB</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 51</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 * a3&quot;</span>
<span class="linenos"> 52</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">MUL</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 53</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 / a3&quot;</span>
<span class="linenos"> 54</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">DIV</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 55</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 == a3&quot;</span>
<span class="linenos"> 56</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">EQ</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 57</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 &lt; a3&quot;</span>
<span class="linenos"> 58</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">LT</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 59</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 &lt;= a3&quot;</span>
<span class="linenos"> 60</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">LE</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 61</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 and a3&quot;</span>
<span class="linenos"> 62</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">AND</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 63</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 or a3&quot;</span>
<span class="linenos"> 64</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">OR</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 65</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 +. a3&quot;</span>
<span class="linenos"> 66</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">FADD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 67</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 -. a3&quot;</span>
<span class="linenos"> 68</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">FSUB</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 69</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 *. a3&quot;</span>
<span class="linenos"> 70</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">FMUL</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 71</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 /. a3&quot;</span>
<span class="linenos"> 72</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">FDIV</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 73</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 ==. a3&quot;</span>
<span class="linenos"> 74</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">FEQ</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 75</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 &lt;. a3&quot;</span>
<span class="linenos"> 76</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">FLT</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 77</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2 &lt;=. a3&quot;</span>
<span class="linenos"> 78</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">FLE</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 79</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = not a2&quot;</span>
<span class="linenos"> 80</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">NOT</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 81</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = - a2&quot;</span>
<span class="linenos"> 82</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">NEG</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 83</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = -. a2&quot;</span>
<span class="linenos"> 84</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">FNEG</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 85</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = float a2&quot;</span>
<span class="linenos"> 86</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">FLOAT</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">);</span><span class="w">  </span>
<span class="linenos"> 87</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2&quot;</span>
<span class="linenos"> 88</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">LOAD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 89</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2&quot; (where a2 is an integer constant)</span>
<span class="linenos"> 90</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">ILOAD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 91</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2&quot; (where a2 is a character constant)</span>
<span class="linenos"> 92</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">CHLOAD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 93</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2&quot; (where a2 is a float constant)</span>
<span class="linenos"> 94</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">FLOAD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 95</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1[a2] = a3&quot; </span>
<span class="linenos"> 96</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">XLOAD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 97</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = a2[a3]&quot; </span>
<span class="linenos"> 98</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">LOADX</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a3</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 99</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = &amp;a2&quot; </span>
<span class="linenos">100</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">ALOAD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="linenos">101</span><span class="w">  </span><span class="c1">// create new instruction &quot;a1 = *a2&quot; </span>
<span class="linenos">102</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">LOADC</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="linenos">103</span><span class="w">  </span><span class="c1">// create new instruction &quot;*a1 = a2&quot; </span>
<span class="linenos">104</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">CLOAD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a2</span><span class="p">);</span><span class="w"></span>
<span class="linenos">105</span><span class="w">  </span><span class="c1">// create new instruction &quot;readi a1&quot; </span>
<span class="linenos">106</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">READI</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">);</span><span class="w"></span>
<span class="linenos">107</span><span class="w">  </span><span class="c1">// create new instruction &quot;readf a1&quot; </span>
<span class="linenos">108</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">READF</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">);</span><span class="w"></span>
<span class="linenos">109</span><span class="w">  </span><span class="c1">// create new instruction &quot;readc a1&quot; </span>
<span class="linenos">110</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">READC</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">);</span><span class="w"></span>
<span class="linenos">111</span><span class="w">  </span><span class="c1">// create new instruction &quot;writei a1&quot; </span>
<span class="linenos">112</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">WRITEI</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">);</span><span class="w"> </span>
<span class="linenos">113</span><span class="w">  </span><span class="c1">// create new instruction &quot;writef a1&quot; </span>
<span class="linenos">114</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">WRITEF</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">);</span><span class="w"></span>
<span class="linenos">115</span><span class="w">  </span><span class="c1">// create new instruction &quot;writec a1&quot; </span>
<span class="linenos">116</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">WRITEC</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">);</span><span class="w"></span>
<span class="linenos">117</span><span class="w">  </span><span class="c1">// create new instruction &quot;writes &#39;string constant&#39;&quot; </span>
<span class="linenos">118</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">WRITES</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a1</span><span class="p">);</span><span class="w"></span>
<span class="linenos">119</span><span class="w">  </span><span class="c1">// create new instruction &quot;writeln&quot; </span>
<span class="linenos">120</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">WRITELN</span><span class="p">();</span><span class="w"></span>
<span class="linenos">121</span><span class="w">  </span><span class="c1">// create new instruction &quot;noop&quot; (not really needed) </span>
<span class="linenos">122</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="nf">NOOP</span><span class="p">();</span><span class="w"></span>
<span class="linenos">123</span><span class="w">  </span>
<span class="linenos">124</span><span class="w">  </span><span class="c1">// print instruction</span>
<span class="linenos">125</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">dump</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w">   </span>
<span class="linenos">126</span><span class="p">};</span><span class="w"></span>
<span class="linenos">127</span>
<span class="linenos">128</span>
<span class="linenos">129</span><span class="c1">////////////////////////////////////////////////////////////////////</span>
<span class="linenos">130</span><span class="c1">/// Class instructionList stores a list of instructions</span>
<span class="linenos">131</span>
<span class="linenos">132</span><span class="k">class</span><span class="w"> </span><span class="nc">instructionList</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">instruction</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">133</span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="linenos">134</span><span class="w">  </span><span class="c1">// constructor</span>
<span class="linenos">135</span><span class="w">  </span><span class="n">instructionList</span><span class="p">();</span><span class="w"></span>
<span class="linenos">136</span><span class="w">  </span><span class="c1">// constructor from a single instruction</span>
<span class="linenos">137</span><span class="w">  </span><span class="n">instructionList</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="o">&amp;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">138</span><span class="w">  </span><span class="c1">// destructor</span>
<span class="linenos">139</span><span class="w">  </span><span class="o">~</span><span class="n">instructionList</span><span class="p">();</span><span class="w"></span>
<span class="linenos">140</span>
<span class="linenos">141</span><span class="w">  </span><span class="c1">// concatenation of lists (or list+instruction, via automatic coertion)</span>
<span class="linenos">142</span><span class="w">  </span><span class="n">instructionList</span><span class="w"> </span><span class="k">operator</span><span class="o">||</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">instructionList</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lst</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
<span class="linenos">143</span>
<span class="linenos">144</span><span class="w">  </span><span class="c1">// print instructionList</span>
<span class="linenos">145</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">dump</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w">   </span>
<span class="linenos">146</span><span class="p">};</span><span class="w"></span>
<span class="linenos">147</span>
<span class="linenos">148</span>
<span class="linenos">149</span><span class="c1">////////////////////////////////////////////////////////////////////</span>
<span class="linenos">150</span><span class="c1">/// Class var stores a variable name and size</span>
<span class="linenos">151</span>
<span class="linenos">152</span><span class="k">class</span><span class="w"> </span><span class="nc">var</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">153</span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="linenos">154</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"></span>
<span class="linenos">155</span><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="linenos">156</span>
<span class="linenos">157</span><span class="w">  </span><span class="n">var</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="linenos">158</span><span class="w">  </span><span class="o">~</span><span class="n">var</span><span class="p">();</span><span class="w"></span>
<span class="linenos">159</span>
<span class="linenos">160</span><span class="w">  </span><span class="c1">// print var</span>
<span class="linenos">161</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">dump</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span>
<span class="linenos">162</span><span class="p">};</span><span class="w"></span>
<span class="linenos">163</span>
<span class="linenos">164</span>
<span class="linenos">165</span><span class="c1">////////////////////////////////////////////////////////////////////</span>
<span class="linenos">166</span><span class="c1">/// Class subroutine stores information about a subroutine (local</span>
<span class="linenos">167</span><span class="c1">/// vars, parametres, instructions, declared/used labels...)</span>
<span class="linenos">168</span>
<span class="linenos">169</span><span class="k">class</span><span class="w"> </span><span class="nc">subroutine</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">170</span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="linenos">171</span><span class="w">  </span><span class="c1">/// list of local variables</span>
<span class="linenos">172</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">var</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vars</span><span class="p">;</span><span class="w"></span>
<span class="linenos">173</span><span class="w">  </span><span class="c1">/// list of params</span>
<span class="linenos">174</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">var</span><span class="o">&gt;</span><span class="w"> </span><span class="n">params</span><span class="p">;</span><span class="w">  </span>
<span class="linenos">175</span>
<span class="linenos">176</span><span class="w">  </span><span class="c1">/// constructor and destructor</span>
<span class="linenos">177</span><span class="w">  </span><span class="n">subroutine</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sname</span><span class="p">);</span><span class="w"></span>
<span class="linenos">178</span><span class="w">  </span><span class="o">~</span><span class="n">subroutine</span><span class="p">();</span><span class="w"></span>
<span class="linenos">179</span>
<span class="linenos">180</span><span class="w">  </span><span class="c1">/// get subroutine name</span>
<span class="linenos">181</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">get_name</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
<span class="linenos">182</span><span class="w">  </span><span class="c1">/// add a local var to subroutine</span>
<span class="linenos">183</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">add_var</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="n">v</span><span class="p">);</span><span class="w"></span>
<span class="linenos">184</span><span class="w">  </span><span class="c1">/// add a local var to subroutine</span>
<span class="linenos">185</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">add_var</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">sz</span><span class="p">);</span><span class="w"></span>
<span class="linenos">186</span><span class="w">  </span><span class="c1">/// add a parameter (size is always 1)</span>
<span class="linenos">187</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">add_param</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="linenos">188</span><span class="w">  </span><span class="c1">/// add an instruction</span>
<span class="linenos">189</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">add_instruction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="o">&amp;</span><span class="n">inst</span><span class="p">);</span><span class="w"></span>
<span class="linenos">190</span><span class="w">  </span><span class="c1">/// add instruction list to current instructions</span>
<span class="linenos">191</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">add_instructions</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">instructionList</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lins</span><span class="p">);</span><span class="w"></span>
<span class="linenos">192</span><span class="w">  </span><span class="c1">/// set instruction list (overwritting current instructions)</span>
<span class="linenos">193</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">set_instructions</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">instructionList</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lins</span><span class="p">);</span><span class="w"></span>
<span class="linenos">194</span><span class="w">  </span>
<span class="linenos">195</span><span class="w">  </span><span class="c1">/// get instruction at given program counter in subroutine</span>
<span class="linenos">196</span><span class="w">  </span><span class="n">instruction</span><span class="w"> </span><span class="nf">get_instruction_at</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">pc</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
<span class="linenos">197</span><span class="w">  </span><span class="c1">/// get program counter in subroutine for given label</span>
<span class="linenos">198</span><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="nf">get_label_pc</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lab</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
<span class="linenos">199</span><span class="w">  </span><span class="c1">/// get the list of instructions (needed only in LLVMCodeGen)</span>
<span class="linenos">200</span><span class="w">  </span><span class="n">instructionList</span><span class="w"> </span><span class="nf">get_instructions</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
<span class="linenos">201</span>
<span class="linenos">202</span><span class="w">  </span><span class="c1">// print subroutine (params, vars, and instructions)</span>
<span class="linenos">203</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">dump</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
<span class="linenos">204</span><span class="p">};</span><span class="w"></span>
<span class="linenos">205</span>
<span class="linenos">206</span>
<span class="linenos">207</span><span class="c1">////////////////////////////////////////////////////////////////////</span>
<span class="linenos">208</span><span class="c1">/// Class code stores a whole program (main plus subroutines)</span>
<span class="linenos">209</span>
<span class="linenos">210</span><span class="k">class</span><span class="w"> </span><span class="nc">code</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">211</span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="linenos">212</span><span class="w">  </span><span class="c1">/// constructor and destructor</span>
<span class="linenos">213</span><span class="w">  </span><span class="n">code</span><span class="p">();</span><span class="w"></span>
<span class="linenos">214</span><span class="w">  </span><span class="o">~</span><span class="n">code</span><span class="p">();</span><span class="w"></span>
<span class="linenos">215</span>
<span class="linenos">216</span><span class="w">  </span><span class="c1">/// get most recently added subroutine (i.e. the one currently being processed)</span>
<span class="linenos">217</span><span class="w">  </span><span class="n">subroutine</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">get_last_subroutine</span><span class="p">();</span><span class="w"></span>
<span class="linenos">218</span><span class="w">  </span><span class="c1">/// get subroutine by name</span>
<span class="linenos">219</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">subroutine</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">get_subroutine</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
<span class="linenos">220</span><span class="w">  </span><span class="c1">/// add new subroutine</span>
<span class="linenos">221</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">add_subroutine</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">subroutine</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="linenos">222</span><span class="w">  </span><span class="c1">/// get the list of subroutines (needed only in LLVMCodeGen)</span>
<span class="linenos">223</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">subroutine</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">get_subroutine_list</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
<span class="linenos">224</span>
<span class="linenos">225</span><span class="w">  </span><span class="c1">// print code (all info for all subroutines)</span>
<span class="linenos">226</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">dump</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
<span class="linenos">227</span><span class="w">  </span><span class="c1">/// print the code in LLVM IR</span>
<span class="linenos">228</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">dumpLLVM</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TypesMgr</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Types</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">SymTable</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Symbols</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"></span>
<span class="linenos">229</span><span class="p">};</span><span class="w"></span>
<span class="linenos">230</span>
<span class="linenos">231</span>
<span class="linenos">232</span><span class="c1">////////////////////////////////////////////////////////////////////</span>
<span class="linenos">233</span><span class="c1">/// Class counters manages temporal and labels counters</span>
<span class="linenos">234</span>
<span class="linenos">235</span><span class="k">class</span><span class="w"> </span><span class="nc">counters</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">236</span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="linenos">237</span><span class="w">  </span><span class="c1">// return id for new label or temp (id is a number, but returned as string</span>
<span class="linenos">238</span><span class="w">  </span><span class="c1">// to ease concatenation with other literals (e.g. &quot;labelIF&quot; + &quot;4&quot; -&gt; &quot;LabelIF4&quot;)</span>
<span class="linenos">239</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">newLabelIF</span><span class="p">();</span><span class="w"></span>
<span class="linenos">240</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">newLabelWHILE</span><span class="p">();</span><span class="w"></span>
<span class="linenos">241</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">newTEMP</span><span class="p">();</span><span class="w"></span>
<span class="linenos">242</span><span class="w">  </span>
<span class="linenos">243</span><span class="w">  </span><span class="c1">// reset individual counters </span>
<span class="linenos">244</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">resetLabelIF</span><span class="p">();</span><span class="w"></span>
<span class="linenos">245</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">resetLabelWHILE</span><span class="p">();</span><span class="w"></span>
<span class="linenos">246</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">resetTEMP</span><span class="p">();</span><span class="w"></span>
<span class="linenos">247</span><span class="w">  </span>
<span class="linenos">248</span><span class="w">  </span><span class="c1">// reset label counters (IF and WHILE)</span>
<span class="linenos">249</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">resetLabels</span><span class="p">();</span><span class="w"></span>
<span class="linenos">250</span><span class="w">  </span><span class="c1">// reset all counters (IF, WHILE, and TEMP)</span>
<span class="linenos">251</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">reset</span><span class="p">();</span><span class="w"></span>
<span class="linenos">252</span><span class="p">};</span><span class="w"></span>
</pre></div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="decoration.html"
                          title="previous chapter">Tree Decoration</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="semerrors.html"
                          title="next chapter">Semantic Errors</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/modules/code.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="semerrors.html" title="Semantic Errors"
             >next</a> |</li>
        <li class="right" >
          <a href="decoration.html" title="Tree Decoration"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CL Lab Project 2022 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../project.html" >Lab Project of Compilers - FIB UPC, 2022</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Code Manager</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018-2022, Compilers. FIB, UPC..
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>